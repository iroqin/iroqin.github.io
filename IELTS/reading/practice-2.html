<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .highlight-correct { background-color: #dcfce7; border-color: #22c55e; color: #15803d; }
        .highlight-wrong { background-color: #fee2e2; border-color: #ef4444; color: #b91c1c; }

        /* Evidence Highlighting (System) */
        .evidence-text { transition: background-color 0.3s ease; border-radius: 2px; }
        .evidence-active { background-color: #fde047; box-shadow: 0 0 0 2px #fde047; color: #000; }
        
        /* User Highlighting */
        ::selection { background-color: #c7d2fe; color: #1e1b4b; } 

        @keyframes pulse-highlight {
            0% { background-color: #fde047; transform: scale(1); }
            50% { background-color: #facc15; transform: scale(1.02); }
            100% { background-color: #fde047; transform: scale(1); }
        }
        .evidence-pulse { animation: pulse-highlight 1s ease-in-out infinite; }

        /* Floating Toolbar */
        #selection-toolbar {
            z-index: 100;
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tabs */
        .tab-btn.active {
            border-bottom: 2px solid #2563eb;
            color: #2563eb;
            font-weight: 600;
        }
        .passage-content { display: none; }
        .passage-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center flex-shrink-0 z-10 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-700 rounded flex items-center justify-center text-white font-bold">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="text-xl font-bold text-gray-800">IELTS Reading: Full Mock Test</h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                <i class="far fa-clock mr-1"></i> 60 mins
            </div>
            <button onclick="resetTest()" class="text-gray-500 hover:text-blue-600 transition-colors">
                <i class="fas fa-redo"></i> Reset
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden flex-col md:flex-row relative">
        
        <!-- Left Panel: Reading Passages (Tabbed) -->
        <section class="flex-1 bg-white border-r border-gray-200 flex flex-col md:w-1/2 overflow-hidden">
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-200 bg-gray-50">
                <button onclick="switchTab(1)" id="tab-1" class="tab-btn active flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 1</button>
                <button onclick="switchTab(2)" id="tab-2" class="tab-btn flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 2</button>
                <button onclick="switchTab(3)" id="tab-3" class="tab-btn flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 3</button>
            </div>

            <!-- Content Container -->
            <div id="passage-container" class="flex-1 overflow-y-auto custom-scroll p-8 scroll-smooth relative" onmouseup="checkSelection()">
                
                <!-- Passage 1: Manatees -->
                <div id="passage-1" class="passage-content active max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">Manatees</h2>
                    <p class="mb-4">Manatees, also known as sea cows, are aquatic mammals that belong to a group of animals called Sirenia. This group also contains dugongs. Dugongs and manatees look quite alike – they are similar in size, colour and shape, and both have flexible flippers for forelimbs. However, <span id="ev-p1-q1" class="evidence-text">the manatee has a broad, rounded tail, whereas the dugong’s is fluked, like that of a whale.</span> There are three species of manatees: the West Indian manatee (Trichechus manatus), the African manatee (Trichechus senegalensis) and the Amazonian manatee (Trichechus inunguis).</p>

                    <p class="mb-4">Unlike most mammals, manatees have only six bones in their neck – most others, including humans and giraffes, have seven. This short neck allows a manatee to move its head up and down, but not side to side. To see something on its left or its right, <span id="ev-p1-q2" class="evidence-text">a manatee must turn its entire body, steering with its flippers.</span></p>

                    <p class="mb-4">Manatees have pectoral flippers but no back limbs, only a tail for propulsion. They do have pelvic bones, however – a leftover from their evolution from a four-legged to a fully aquatic animal. Manatees share some visual similarities to elephants. Like elephants, manatees have thick, wrinkled skin. They also have <span id="ev-p1-q3" class="evidence-text">some hairs covering their bodies which help them sense vibrations in the water around them.</span></p>

                    <p class="mb-4"><span id="ev-p1-q4" class="evidence-text">Seagrasses and other marine plants make up most of a manatee’s diet.</span> Manatees spend about eight hours each day grazing and uprooting plants. They eat up to 15% of their weight in food each day. African manatees are omnivorous – studies have shown that molluscs and fish make up a small part of their diets. West Indian and Amazonian manatees are both herbivores.</p>

                    <p class="mb-4">Manatees’ teeth are all molars – flat, rounded teeth for grinding food. Due to manatees’ abrasive aquatic plant diet, these teeth get worn down and they eventually fall out, so they continually grow new teeth that get pushed forward to replace the ones they lose. Instead of having incisors to grasp their food, <span id="ev-p1-q5" class="evidence-text">manatees have lips which function like a pair of hands to help tear food away from the seafloor.</span></p>

                    <p class="mb-4">Manatees are fully aquatic, but as mammals, they need to come up to the surface to breathe. When awake, they typically surface every two to four minutes, but they can hold their breath for much longer. Adult manatees sleep underwater for 10–12 hours a day, but they come up for air every 15–20 minutes. Active manatees need to breathe more frequently. It’s thought that manatees use their muscular diaphragm and breathing to adjust their buoyancy. <span id="ev-p1-q6" class="evidence-text">They may use diaphragm contractions to compress and store gas in folds in their large intestine to help them float.</span></p>

                    <p class="mb-4">The West Indian manatee reaches about 3.5 metres long and weighs on average around 500 kilogrammes. <span id="ev-p1-q7" class="evidence-text">It moves between fresh water and salt water, taking advantage of coastal mangroves and coral reefs, rivers, lakes and inland lagoons.</span> There are two subspecies of West Indian manatee: the Antillean manatee is found in waters from the Bahamas to Brazil, whereas the Florida manatee is found in US waters, although some individuals have been recorded in the Bahamas. In winter, the Florida manatee is typically restricted to Florida. When the ambient water temperature drops below 20°C, it takes refuge in naturally and artificially warmed water, such as at the warm-water outfalls from powerplants.</p>

                    <p class="mb-4">The African manatee is also about 3.5 metres long and found in the sea along the west coast of Africa, from Mauritania down to Angola. <span id="ev-p1-q9" class="evidence-text">The species also makes use of rivers, with the mammals seen in landlocked countries such as Mali and Niger.</span> The Amazonian manatee is the smallest species, though it is still a big animal. It grows to about 2.5 metres long and 350 kilogrammes. Amazonian manatees favour calm, shallow waters that are above 23°C. This species is found in fresh water in the Amazon Basin in Brazil, as well as in Colombia, Ecuador and Peru.</p>

                    <p class="mb-4">All three manatee species are endangered or at a heightened risk of extinction. The African manatee and Amazonian manatee are both listed as Vulnerable by the International Union for Conservation of Nature (IUCN). <span id="ev-p1-q10" class="evidence-text">It is estimated that 140,000 Amazonian manatees were killed between 1935 and 1954 for their meat, fat and skin</span>, with the latter used to make leather. In more recent years, African manatee decline has been tied to incidental capture in fishing nets and hunting. Manatee hunting is now illegal in every country the African species is found in.</p>

                    <p class="mb-4">The two subspecies of West Indian manatee are listed as Endangered by the IUCN. <span id="ev-p1-q11" class="evidence-text">Both are also expected to undergo a decline of 20% over the next 40 years.</span> <span id="ev-p1-q12" class="evidence-text">A review of almost 1,800 cases of entanglement in fishing nets and of plastic consumption among marine mammals in US waters from 2009 to 2020 found that at least 700 cases involved manatees.</span> The chief cause of death in Florida manatees is boat strikes. However, <span id="ev-p1-q13" class="evidence-text">laws in certain parts of Florida now limit boat speeds during winter, allowing slow-moving manatees more time to respond.</span></p>
                </div>

                <!-- Passage 2: Procrastination -->
                <div id="passage-2" class="passage-content max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">Procrastination</h2>
                    <p class="mb-4 italic text-gray-600">A psychologist explains why we put off important tasks and how we can break this habit</p>
                    
                    <p class="mb-4"><span class="font-bold text-blue-800">A</span> Procrastination is the habit of delaying a necessary task, usually by focusing on less urgent, more enjoyable, and easier activities instead. We all do it from time to time. We might be composing a message to a friend who we have to let down, or putting together an important report for college or work; we’re doing our best to avoid doing the job at hand, but deep down we know that we should just be getting on with it. Unfortunately, berating ourselves won’t stop us procrastinating again. In fact, it’s one of the worst things we can do. This matters because, as my research shows, procrastination doesn’t just waste time, but is actually linked to other problems, too.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">B</span> <span id="ev-p2-q17" class="evidence-text"><span id="ev-p2-q14" class="evidence-text">Contrary to popular belief, procrastination is not due to laziness or poor time management.</span> Scientific studies suggest procrastination is, in fact, caused by poor mood management.</span> The tasks we are most likely to put off are those that could damage our self-esteem or <span id="ev-p2-q18" class="evidence-text">make us anxious</span>, we will be more likely to put it off. <span id="ev-p2-q16" class="evidence-text">Research involving brain imaging has found that areas of the brain linked to <span id="ev-p2-q19" class="evidence-text">detection of threats</span> and emotion regulation are actually different in people who chronically procrastinate compared to those who don’t procrastinate frequently.</span></p>

                    <p class="mb-4"><span class="font-bold text-blue-800">C</span> Tasks that are emotionally loaded or difficult, such as <span id="ev-p2-q20" class="evidence-text">preparing for exams</span>, are prime candidates for procrastination. People with low self-esteem are more likely to procrastinate. <span id="ev-p2-q21" class="evidence-text">Another group of people who tend to procrastinate are perfectionists</span>, who worry their work will be judged harshly by others. We know that if we don’t finish that report or complete those home repairs, then what we did can’t be evaluated. When we avoid such tasks, we also avoid the negative emotions associated with them. This is rewarding, and it conditions us to use procrastination to repair our mood. If we engage in more enjoyable tasks instead, we get another mood boost. In the long run, however, procrastination isn’t an effective way of managing emotions. The ‘mood repair’ we experience is temporary. Afterwards, people tend to be <span id="ev-p2-q22" class="evidence-text">left with a sense of guilt</span> that not only increases their negative mood, but also reinforces their tendency to procrastinate.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">D</span> So why is this such a problem? When most people think of the costs of procrastination, they think of the toll on productivity. For example, studies have shown that procrastination negatively impacts on student performance. But putting off reading textbooks and writing essays may affect other areas of students’ lives. In one study of over 3,000 German students over a six-month period, those who reported procrastinating over their university work were also more likely to engage in study-related misconduct, such as cheating and plagiarism. But the behaviour that procrastination was most closely linked with was using fraudulent excuses to get deadline extensions. Other research shows that employees on average spend almost a quarter of their workday procrastinating, and again this is linked with negative outcomes. In fact, in one US survey of over 22,000 employees, participants who said they regularly procrastinated had <span id="ev-p2-q23" class="evidence-text">less annual income</span> and <span id="ev-p2-q24" class="evidence-text">less employment stability</span>. For every one point increase on a measure of chronic procrastination, annual income decreased by US$15,000.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">E</span> Procrastination also correlates with serious health and well-being problems. A tendency to procrastinate is linked to poor mental health, including higher levels of depression and anxiety. Across numerous studies, I’ve found people who regularly procrastinate report a greater number of health issues, such as headaches, flu and colds, and digestive issues. They also experience higher levels of stress and poor sleep quality. They are less likely to practise healthy behaviours, such as eating a healthy diet and regularly exercising, and use destructive coping strategies to manage their stress. In one study of over 700 people, I found people prone to procrastination had a 63% greater risk of poor heart health after accounting for other personality traits and demographics.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">F</span> Finding better ways of managing our emotions is one route out of the vicious cycle of procrastination. An important first step is to manage our environment and how we view the task. There are a number of evidence-based strategies that can help us <span id="ev-p2-q26" class="evidence-text">fend off distractions</span> that can occupy our minds when we should be focusing on the thing we should be getting on with. For example, reminding ourselves about why the task is important and valuable can increase positive feelings towards it. <span id="ev-p2-q25" class="evidence-text">Forgiving ourselves and feeling compassion when we procrastinate can help break the procrastination cycle. We should admit that we feel bad, but not be overly critical of ourselves.</span> <span id="ev-p2-q15" class="evidence-text">We should remind ourselves that we’re not the first person to procrastinate, nor the last.</span> Doing this can take the edge off the negative feelings we have about ourselves when we procrastinate. This can all make it easier to get back on track.</p>
                </div>

                <!-- Passage 3: Invasion of the Robot Umpires -->
                <div id="passage-3" class="passage-content max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">Invasion of the Robot Umpires</h2>
                    <p class="mb-4">A few years ago, Fred DeJesus from Brooklyn, New York became the first umpire in a minor league baseball game to use something called the Automated Ball-Strike System (ABS), often referred to as the 'robo-umpire'. <span id="ev-p3-q27" class="evidence-text">Instead of making any judgments himself about a strike*, DeJesus had decisions fed to him through an earpiece, connected to a modified missile-tracking system.</span> The contraption looked like a large black pizza box with one glowing green eye; it was mounted above the press stand.</p>

                    <p class="mb-4">Major League Baseball (MLB), who had commissioned the system, wanted human umpires to <span id="ev-p3-q33" class="evidence-text">announce the calls, just as they would have done in the past.</span> When the first pitch came in, a recorded voice told DeJesus it was a strike. Previously, <span id="ev-p3-q34" class="evidence-text">calling a strike was a judgment call on the part of the umpire.</span> Even if the batter does not hit the ball, a pitch that passes through the 'strike zone' (an <span id="ev-p3-q35" class="evidence-text">imaginary zone about seventeen inches wide, stretching from the batter's knees to the middle of his chest</span>) is considered a strike. During that first game, when DeJesus announced calls, there was no heckling and no shouted disagreement. <span id="ev-p3-q37" class="evidence-text">Nobody said a word.</span></p>

                    <p class="mb-4">For a hundred and fifty years or so, the strike zone has been the game's animating force—<span id="ev-p3-q36" class="evidence-text">countless arguments between a team's manager and the umpire have taken place over its boundaries</span> and whether a ball had crossed through it. The rules of play have evolved in various stages. Today, everyone knows that you may scream your disagreement in an umpire's face, but you must never shout personal abuse at them or touch them. That's a no-no. When the robo-umpires came, however, the arguments stopped.</p>

                    <p class="mb-4">During the first robo-umpire season, <span id="ev-p3-q28" class="evidence-text">players complained about some strange calls. In response, MLB decided to tweak the dimensions of the zone</span>, and the following year the consensus was that ABS is profoundly consistent. <span id="ev-p3-q29" class="evidence-text">MLB says the device is near-perfect, precise to within fractions of an inch.</span> "It'll reduce controversy in the game, and be good for the game," says Rob Manfred, who is Commissioner for MLB. But <span id="ev-p3-q38" class="evidence-text">the question is whether controversy is worth reducing, or whether it is the sign of a human hand. A human, at least, yells back.</span> When I spoke with Frank Viola, a coach for a North Carolina team, he said that ABS works as designed, but that it was also unforgiving and pedantic, almost legalistic. "Manfred is a lawyer," Viola noted. Some pitchers have complained that, compared with a human's, the robot's strike zone seems too precise. Viola was once a major-league player himself. When he was pitching, he explained, umpires rewarded skill. "Throw it where you aimed, and it would be a strike, even if it was an inch or two outside. There was a dialogue between pitcher and umpire."</p>

                    <p class="mb-4">The executive tasked with running the experiment for MLB is Morgan Sword, who's in charge of baseball operations. According to Sword, ABS was part of a larger project to make baseball more exciting since <span id="ev-p3-q39" class="evidence-text">executives are terrified of losing younger fans</span>, as has been the case with horse racing and boxing. He explains how they began the process by asking fans what version of baseball they found most exciting. The results showed that everyone wanted more action: more hits, more defense, more baserunning. This type of baseball essentially hasn't existed since the 1960s, when <span id="ev-p3-q30" class="evidence-text">the hundred-mile-an-hour fastball, which is difficult to hit and control, entered the game. It flattened the game into strikeouts, walks, and home runs—a type of play lacking much action.</span></p>

                    <p class="mb-4">Sword's team brainstormed potential fixes. <span id="ev-p3-q31" class="evidence-text">Any rule that existed, they talked about changing—from changing the bats to changing the geometry of the field. But while all of these were ruled out as potential fixes</span>, ABS was seen as a perfect vehicle for change. According to Sword, once you get the technology right, you can load any strike zone you want into the system. "It might be a triangle, or a blob, or something shaped like Texas. Over time, as baseball evolves, <span id="ev-p3-q32" class="evidence-text">ABS can allow the zone to change with it."</span></p>

                    <p class="mb-4">"In the past twenty years, sports have moved away from judgment calls. Soccer has Video Assistant Referees (for offside decisions, for example). Tennis has Hawk-Eye (for line calls, for example). For almost a decade, baseball has used instant replay on the base paths. This is widely liked, even if the precision can sometimes cause problems. But these applications deal with something physical: bases, lines, goals. The boundaries of action are precise, delineated like the keys of a piano. This is not the case with ABS and the strike zone. Historically, a certain discretion has been appreciated."</p>

                    <p class="mb-4">I decided to email Alva Noë, a professor at Berkeley University and a baseball fan, for his opinion. "Hardly a day goes by that I don't wake up and run through the reasons that this [robo-umpires] is such a terrible idea," he replied. He later told me, "This is part of a movement to use algorithms to take the hard choices of living out of life." Perhaps he's right. We watch baseball to kill time, not to maximize it. Some players I have met take a dissenting stance toward the robots too, believing that accuracy is not the answer. According to Joe Russo, who plays for a New Jersey team, "With technology, people just want everything to be perfect. That's not reality. I think perfect would be weird. Your teams are always winning, work is always just great, there's always money in your pocket, your car never breaks down. <span id="ev-p3-q40" class="evidence-text">What is there to talk about?"</span></p>

                    <p class="text-sm italic text-gray-500 border-t pt-2 mt-4">*strike: a strike is when the batter swings at a ball and misses or when the batter does not swing at a ball that passes through the strike zone.</p>
                </div>
            </div>

            <!-- Highlighter Toolbar -->
            <div id="selection-toolbar" class="hidden fixed bg-gray-900 text-white rounded shadow-xl py-1 px-2 flex gap-1 z-50 text-sm">
                <button onclick="performHighlight()" class="hover:bg-gray-700 px-3 py-1 rounded transition-colors flex items-center gap-2">
                    <div class="w-3 h-3 bg-yellow-200 rounded-full border border-yellow-400"></div> Highlight
                </button>
                <div class="w-px bg-gray-700 my-1"></div>
                <button onclick="clearHighlight()" class="hover:bg-gray-700 px-3 py-1 rounded transition-colors text-gray-300">
                    <i class="fas fa-eraser"></i>
                </button>
            </div>
        </section>

        <!-- Right Panel: Questions -->
        <section class="flex-1 bg-gray-50 overflow-y-auto custom-scroll p-8 md:w-1/2 relative" id="questions-panel">
            <div class="max-w-2xl mx-auto pb-24">
                <div id="questions-container" class="space-y-12">
                    <!-- Questions injected via JS -->
                </div>
            </div>

            <!-- Floating Action Bar -->
            <div class="fixed bottom-0 right-0 w-full md:w-1/2 bg-white border-t border-gray-200 p-4 shadow-lg flex justify-between items-center z-20">
                <div id="score-display" class="hidden font-bold text-gray-800 text-lg">
                    Score: <span id="score-value" class="text-blue-600">0</span>/40
                </div>
                <div class="ml-auto flex gap-3">
                    <button onclick="checkAnswers()" id="btn-check" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow-sm transition-all transform hover:scale-105 active:scale-95">
                        Check Answers
                    </button>
                    <button onclick="resetTest()" id="btn-retry" class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold transition-colors">
                        Retry
                    </button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- DATA ---
        const testData = {
            passage1: {
                gapFill: [
                    { id: 1, correct: ["tail"], evidenceId: "ev-p1-q1" },
                    { id: 2, correct: ["flippers"], evidenceId: "ev-p1-q2" },
                    { id: 3, correct: ["hairs"], evidenceId: "ev-p1-q3" },
                    { id: 4, correct: ["seagrasses"], evidenceId: "ev-p1-q4" },
                    { id: 5, correct: ["lips"], evidenceId: "ev-p1-q5" },
                    { id: 6, correct: ["buoyancy"], evidenceId: "ev-p1-q6" }
                ],
                tfng: [
                    { id: 7, text: "West Indian manatees can be found in a variety of different aquatic habitats.", correct: "TRUE", evidenceId: "ev-p1-q7" },
                    { id: 8, text: "The Florida manatee lives in warmer waters than the Antillean manatee.", correct: "NOT GIVEN", evidenceId: "" },
                    { id: 9, text: "The African manatee’s range is limited to coastal waters between the West African countries of Mauritania and Angola.", correct: "FALSE", evidenceId: "ev-p1-q9" },
                    { id: 10, text: "The extent of the loss of Amazonian manatees in the mid-twentieth century was only revealed many years later.", correct: "NOT GIVEN", evidenceId: "ev-p1-q10" },
                    { id: 11, text: "It is predicted that West Indian manatee populations will fall in the coming decades.", correct: "TRUE", evidenceId: "ev-p1-q11" },
                    { id: 12, text: "The risk to manatees from entanglement and plastic consumption increased significantly in the period 2009–2020.", correct: "NOT GIVEN", evidenceId: "ev-p1-q12" },
                    { id: 13, text: "There is some legislation in place which aims to reduce the likelihood of boat strikes on manatees in Florida.", correct: "TRUE", evidenceId: "ev-p1-q13" }
                ]
            },
            passage2: {
                matchingInfo: [
                    { id: 14, text: "mention of false assumptions about why people procrastinate", correct: "B", evidenceId: "ev-p2-q14" },
                    { id: 15, text: "reference to the realisation that others also procrastinate", correct: "F", evidenceId: "ev-p2-q15" },
                    { id: 16, text: "neurological evidence of a link between procrastination and emotion", correct: "B", evidenceId: "ev-p2-q16" }
                ],
                summary: [
                    { id: 17, correct: ["laziness"], evidenceId: "ev-p2-q17" },
                    { id: 18, correct: ["anxious"], evidenceId: "ev-p2-q18" },
                    { id: 19, correct: ["threats"], evidenceId: "ev-p2-q19" },
                    { id: 20, correct: ["exams"], evidenceId: "ev-p2-q20" },
                    { id: 21, correct: ["perfectionists"], evidenceId: "ev-p2-q21" },
                    { id: 22, correct: ["guilt"], evidenceId: "ev-p2-q22" }
                ],
                multiSelect1: {
                    id: "23_24",
                    correct: ["A", "C"], // A: Lower salaries, C: Less stability
                    evidenceIdA: "ev-p2-q23",
                    evidenceIdC: "ev-p2-q24"
                },
                multiSelect2: {
                    id: "25_26",
                    correct: ["A", "E"], // A: Not judging harshly, E: Avoiding things that stop us concentrating
                    evidenceIdA: "ev-p2-q25",
                    evidenceIdE: "ev-p2-q26"
                }
            },
            passage3: {
                yesNoNg: [
                    { id: 27, text: "When DeJesus first used ABS, he shared decision-making about strikes with it.", correct: "NO", evidenceId: "ev-p3-q27" },
                    { id: 28, text: "MLB considered it necessary to amend the size of the strike zone when criticisms were received from players.", correct: "YES", evidenceId: "ev-p3-q28" },
                    { id: 29, text: "MLB is keen to justify the money spent on improving the accuracy of ABS's calculations.", correct: "NOT GIVEN", evidenceId: "ev-p3-q29" },
                    { id: 30, text: "The hundred-mile-an-hour fastball led to a more exciting style of play.", correct: "NO", evidenceId: "ev-p3-q30" },
                    { id: 31, text: "The differing proposals for alterations to the baseball bat led to fierce debate on Sword's team.", correct: "NOT GIVEN", evidenceId: "ev-p3-q31" },
                    { id: 32, text: "ABS makes changes to the shape of the strike zone feasible.", correct: "YES", evidenceId: "ev-p3-q32" }
                ],
                summary: [
                    { id: 33, correct: "F", evidenceId: "ev-p3-q33" }, // former roles
                    { id: 34, correct: "D", evidenceId: "ev-p3-q34" }, // subjective assessment
                    { id: 35, correct: "H", evidenceId: "ev-p3-q35" }, // perceived area (imaginary zone)
                    { id: 36, correct: "B", evidenceId: "ev-p3-q36" }, // numerous disputes
                    { id: 37, correct: "G", evidenceId: "ev-p3-q37" }  // total silence
                ],
                mcq: [
                    { id: 38, text: "What does the writer suggest about ABS in the fifth paragraph?", options: ["A. It is bound to make key decisions that are wrong.", "B. It may reduce some of the appeal of the game.", "C. It will lead to the disappearance of human umpires.", "D. It may increase calls for the rules of baseball to be changed."], correct: "B", evidenceId: "ev-p3-q38" },
                    { id: 39, text: "Morgan Sword says that the introduction of ABS", options: ["A. was regarded as an experiment without a guaranteed outcome.", "B. was intended to keep up with developments in other sports.", "C. was a response to changing attitudes about the role of sport.", "D. was an attempt to ensure baseball retained a young audience."], correct: "D", evidenceId: "ev-p3-q39" },
                    { id: 40, text: "Why does the writer include the views of Noë and Russo?", options: ["A. to show that attitudes to technology vary widely", "B. to argue that people have unrealistic expectations of sport", "C. to indicate that accuracy is not the same thing as enjoyment", "D. to suggest that the number of baseball fans needs to increase"], correct: "C", evidenceId: "ev-p3-q40" }
                ]
            }
        };

        // --- INIT ---
        function init() {
            renderQuestions();
            setupHighlighter();
        }

        // --- TABS ---
        function switchTab(id) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.passage-content').forEach(content => content.classList.remove('active'));
            
            document.getElementById(`tab-${id}`).classList.add('active');
            document.getElementById(`passage-${id}`).classList.add('active');
        }

        // --- RENDERERS ---
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            let html = '';

            // --- Passage 1 Questions ---
            html += `<div class="border-b-2 border-gray-200 pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 1: Manatees</h3>`;
            
            // Q1-6 (Notes)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6">
                <h4 class="font-bold mb-2">Questions 1-6</h4>
                <p class="text-sm italic mb-4">Complete the notes below (ONE WORD AND/OR A NUMBER)</p>
                <div class="space-y-4 bg-blue-50 p-6 rounded border border-blue-100 text-sm leading-7">
                    <h5 class="font-bold text-center text-blue-900 text-lg mb-4">Manatees</h5>
                    
                    <div class="font-bold text-blue-900">Appearance</div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>look similar to dugongs, but with a differently shaped ${createInlineInput(1)}</li>
                    </ul>
                    
                    <div class="font-bold text-blue-900 mt-4">Movement</div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>have fewer neck bones than most mammals</li>
                        <li>need to use their ${createInlineInput(2)} to help to turn their bodies around in order to look sideways</li>
                        <li>sense vibrations in the water by means of ${createInlineInput(3)} on their skin</li>
                    </ul>

                    <div class="font-bold text-blue-900 mt-4">Feeding</div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>eat mainly aquatic vegetation, such as ${createInlineInput(4)}</li>
                        <li>grasp and pull up plants with their ${createInlineInput(5)}</li>
                    </ul>

                    <div class="font-bold text-blue-900 mt-4">Breathing</div>
                    <ul class="list-disc pl-5 space-y-2">
                        <li>come to the surface for air every 2–4 minutes when awake and every 15–20 while sleeping</li>
                        <li>may regulate the ${createInlineInput(6)} of their bodies by using muscles of diaphragm to store air internally</li>
                    </ul>
                </div>
            </div>`;

            // Q7-13 (TFNG)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 7-13</h4><p class="text-sm italic mb-4">True / False / Not Given</p><div class="space-y-4">`;
            testData.passage1.tfng.forEach(q => {
                html += createRadioBlock(q, ['TRUE', 'FALSE', 'NOT GIVEN']);
            });
            html += `</div></div></div>`;

            // --- Passage 2 Questions ---
            html += `<div class="border-b-2 border-gray-200 pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 2: Procrastination</h3>`;
            
            // Q14-16 (Matching Info)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 14-16</h4><p class="text-sm italic mb-4">Which paragraph (A-F) contains the following information?</p><div class="space-y-4">`;
            testData.passage2.matchingInfo.forEach(q => {
                html += createRadioBlock(q, ['A','B','C','D','E','F']);
            });
            html += `</div></div>`;

            // Q17-22 (Summary)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 17-22</h4><p class="text-sm italic mb-4">Complete the summary (ONE WORD ONLY)</p>
            <div class="p-4 bg-gray-50 rounded border leading-8 text-sm">
                <h5 class="font-bold text-center text-gray-800 mb-2">What makes us procrastinate?</h5>
                Many people think that procrastination is the result of ${createInlineInput(17)}. Others believe it to be the result of an inability to organise time efficiently. But scientific studies suggest that procrastination is actually due to poor mood management. The tasks we are most likely to put off are those that could damage our self-esteem or cause us to feel ${createInlineInput(18)} when we think about them. Research comparing chronic procrastinators with other people even found differences in the brain regions associated with regulating emotions and identifying ${createInlineInput(19)}. Emotionally loaded and difficult tasks often cause us to procrastinate. Getting ready to take ${createInlineInput(20)} might be a typical example of one such task. People who are likely to procrastinate tend to be either ${createInlineInput(21)} or those with low self-esteem. Procrastination is only a short-term measure for managing emotions. It’s often followed by a feeling of ${createInlineInput(22)}, which worsens our mood and leads to more procrastination.
            </div></div>`;

            // Q23-24 (Pick Two)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 23 and 24</h4><p class="text-sm italic mb-4">Choose TWO letters, A-E. Which TWO comparisons between employees who often procrastinate and those who do not are mentioned?</p>
            <div class="question-block" data-id="23_24">
                <div class="space-y-2 ml-2 text-sm text-gray-700">
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q23_24" value="A" class="mr-2"> A. Their salaries are lower.</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q23_24" value="B" class="mr-2"> B. The quality of their work is inferior.</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q23_24" value="C" class="mr-2"> C. They don’t keep their jobs for as long.</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q23_24" value="D" class="mr-2"> D. They don’t enjoy their working lives as much.</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q23_24" value="E" class="mr-2"> E. They have poorer relationships with colleagues.</label>
                </div>
                <div class="feedback mt-2 hidden text-sm"></div>
            </div></div>`;

            // Q25-26 (Pick Two)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 25 and 26</h4><p class="text-sm italic mb-4">Choose TWO letters, A-E. Which TWO recommendations for getting out of a cycle of procrastination does the writer give?</p>
            <div class="question-block" data-id="25_26">
                <div class="space-y-2 ml-2 text-sm text-gray-700">
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q25_26" value="A" class="mr-2"> A. not judging ourselves harshly</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q25_26" value="B" class="mr-2"> B. setting ourselves manageable aims</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q25_26" value="C" class="mr-2"> C. rewarding ourselves for tasks achieved</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q25_26" value="D" class="mr-2"> D. prioritising tasks according to their importance</label>
                    <label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="checkbox" name="q25_26" value="E" class="mr-2"> E. avoiding things that stop us concentrating on our tasks</label>
                </div>
                <div class="feedback mt-2 hidden text-sm"></div>
            </div></div></div>`;


            // --- Passage 3 Questions ---
            html += `<div class="pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 3: Invasion of the Robot Umpires</h3>`;
            
            // Q27-32 (Yes/No/NG)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 27-32</h4><p class="text-sm italic mb-4">Yes / No / Not Given</p><div class="space-y-4">`;
            testData.passage3.yesNoNg.forEach(q => {
                html += createRadioBlock(q, ['YES', 'NO', 'NOT GIVEN']);
            });
            html += `</div></div>`;

            // Q33-37 (Summary with Options)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 33-37</h4><p class="text-sm italic mb-4">Complete the summary using the list of phrases, A-H.</p>
                <div class="grid grid-cols-2 gap-2 mb-4 text-xs bg-gray-50 p-3 rounded border">
                    <div>A. pitch boundary</div><div>B. numerous disputes</div>
                    <div>C. team tactics</div><div>D. subjective assessment</div>
                    <div>E. widespread approval</div><div>F. former roles</div>
                    <div>G. total silence</div><div>H. perceived area</div>
                </div>
                <div class="p-4 bg-gray-50 rounded border leading-8 text-sm">
                    <h5 class="font-bold text-center text-gray-800 mb-2">Calls by the umpire</h5>
                    Even after ABS was developed, MLB still wanted human umpires to shout out decisions as they had in their ${createInlineInput(33)}. The umpire's job had, at one time, required a ${createInlineInput(34)} about whether a ball was a strike. A ball is considered a strike when the batter does not hit it and it crosses through a ${createInlineInput(35)} extending approximately from the batter's knee to his chest. In the past, ${createInlineInput(36)} over strike calls were not uncommon, but today everyone accepts the complete ban on pushing or shoving the umpire. One difference, however, is that during the first game DeJesus used ABS, strike calls were met with ${createInlineInput(37)}.
                </div>
            </div>`;

            // Q38-40 (MCQ)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 38-40</h4><p class="text-sm italic mb-4">Choose the correct letter A, B, C or D</p><div class="space-y-6">`;
            testData.passage3.mcq.forEach(q => {
                html += `<div class="question-block" data-id="${q.id}">
                    <div class="flex gap-2 font-bold text-gray-700"><span>${q.id}.</span> <p>${q.text}</p></div>
                    <div class="mt-2 space-y-2 ml-6">
                        ${q.options.map(opt => {
                            const val = opt.charAt(0);
                            return `<label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="radio" name="q${q.id}" value="${val}" class="mr-2"> ${opt}</label>`;
                        }).join('')}
                    </div>
                    <div class="feedback mt-2 ml-6 hidden text-sm"></div>
                </div>`;
            });
            html += `</div></div></div>`;

            container.innerHTML = html;
        }

        // --- HELPER BUILDERS ---
        function createRadioBlock(q, options) {
            return `
            <div class="question-block border-b border-gray-100 pb-3 last:border-0" data-id="${q.id}">
                <div class="flex gap-4">
                    <span class="font-bold text-gray-500 w-6 pt-1">${q.id}</span>
                    <div class="flex-1">
                        <p class="mb-2 text-gray-800 text-sm">${q.text}</p>
                        <div class="flex flex-wrap gap-2">
                            ${options.map(opt => `
                                <label class="cursor-pointer">
                                    <input type="radio" name="q${q.id}" value="${opt}" class="peer sr-only">
                                    <div class="px-3 py-1 rounded border border-gray-300 text-xs font-bold text-gray-600 bg-white 
                                                peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 
                                                hover:bg-gray-50 transition-all select-none">
                                        ${opt}
                                    </div>
                                </label>
                            `).join('')}
                        </div>
                        <div class="feedback mt-2 hidden text-sm"></div>
                    </div>
                </div>
            </div>`;
        }

        function createInlineInput(id) {
            return `<span class="inline-block relative mx-1 align-baseline">
                <span class="font-bold text-gray-400 absolute -left-4 -top-2 text-xs">${id}</span>
                <input type="text" id="q${id}" class="w-28 border-b-2 border-gray-400 bg-transparent px-1 text-center focus:outline-none focus:border-blue-600 font-bold text-blue-900 text-sm h-6">
                <div class="feedback-inline absolute hidden bg-white shadow-lg p-2 rounded z-10 text-xs w-40 border top-full left-0 mt-1"></div>
            </span>`;
        }

        // --- CHECKING LOGIC ---
        function checkAnswers() {
            let score = 0;
            const feedbackBtn = (pid, eid) => eid ? `<button onclick="showEvidence(${pid}, '${eid}')" class="ml-2 text-blue-600 hover:bg-blue-50 px-2 rounded" title="Show Evidence"><i class="fas fa-eye"></i></button>` : '';

            // Common feedback logic
            const processResult = (element, isCorrect, correctAns, pid, eid) => {
                let feedbackEl = element.querySelector('.feedback');
                if (!feedbackEl) {
                    if(element.nextElementSibling && element.nextElementSibling.classList.contains('feedback-inline')) {
                        feedbackEl = element.nextElementSibling;
                    }
                }
                
                if (!feedbackEl) return;
                
                feedbackEl.classList.remove('hidden');
                feedbackEl.className = feedbackEl.classList.contains('feedback-inline') 
                    ? "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " 
                    : "feedback mt-2 text-sm p-2 rounded block ";
                
                feedbackEl.classList.add(isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                if(feedbackEl.classList.contains('feedback-inline')) feedbackEl.style.border = isCorrect ? "1px solid #bbf7d0" : "1px solid #fecaca";

                if (isCorrect) {
                    score++;
                    feedbackEl.innerHTML = `<i class="fas fa-check mr-1"></i> Correct! ${feedbackBtn(pid, eid)}`;
                } else {
                    feedbackEl.innerHTML = `<i class="fas fa-times mr-1"></i> Correct: <strong>${correctAns}</strong> ${feedbackBtn(pid, eid)}`;
                }
            };

            // Passage 1: Notes
            testData.passage1.gapFill.forEach(q => {
                const inp = document.getElementById(`q${q.id}`);
                const val = inp.value.trim().toLowerCase();
                // Find parent list item or div
                const parent = inp.parentElement; 
                
                // Helper to create feedback element if missing
                let feedback = inp.nextElementSibling;
                if(!feedback || !feedback.classList.contains('feedback-inline')) feedback = inp.nextElementSibling;
                
                const isCorrect = q.correct.includes(val);
                feedback.classList.remove('hidden');
                feedback.className = "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " + (isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                
                if(isCorrect) { score++; feedback.innerHTML = `<i class="fas fa-check"></i> Correct! ${feedbackBtn(1, q.evidenceId)}`; }
                else { feedback.innerHTML = `<i class="fas fa-times"></i> Ans: <strong>${q.correct[0]}</strong> ${feedbackBtn(1, q.evidenceId)}`; }
            });

            // Passage 1: TFNG
            testData.passage1.tfng.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 1, q.evidenceId);
            });

            // Passage 2: Matching
            testData.passage2.matchingInfo.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 2, q.evidenceId);
            });

            // Passage 2: Summary
            testData.passage2.summary.forEach(q => {
                const inp = document.getElementById(`q${q.id}`);
                const val = inp.value.trim().toLowerCase();
                const feedback = inp.nextElementSibling;
                const isCorrect = q.correct.includes(val);
                
                feedback.classList.remove('hidden');
                feedback.className = "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " + (isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                
                if(isCorrect) { score++; feedback.innerHTML = `<i class="fas fa-check"></i> Correct! ${feedbackBtn(2, q.evidenceId)}`; }
                else { feedback.innerHTML = `<i class="fas fa-times"></i> Ans: <strong>${q.correct[0]}</strong> ${feedbackBtn(2, q.evidenceId)}`; }
            });

            // Passage 2: Multi-Select (Logic specific)
            ['multiSelect1', 'multiSelect2'].forEach(key => {
                const q = testData.passage2[key];
                const els = document.querySelectorAll(`input[name="q${q.id}"]:checked`);
                const block = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const feedback = block.querySelector('.feedback');
                
                const selected = Array.from(els).map(e => e.value).sort();
                const correct = q.correct.sort();
                
                // Exact match check for multi-select
                const isCorrect = JSON.stringify(selected) === JSON.stringify(correct);
                
                feedback.classList.remove('hidden');
                feedback.className = "feedback mt-2 text-sm p-2 rounded block " + (isCorrect ? "bg-green-50 text-green-800" : "bg-red-50 text-red-800");

                const btnA = feedbackBtn(2, q.evidenceIdA);
                const btn2 = key === 'multiSelect1' ? feedbackBtn(2, testData.passage2.multiSelect1.evidenceIdC) : feedbackBtn(2, testData.passage2.multiSelect2.evidenceIdE);
                
                if(isCorrect) {
                    score += 2; // Usually 1 mark per correct letter in IELTS, but here we group them. Let's count as 2 for full correct block.
                    feedback.innerHTML = `<i class="fas fa-check"></i> Correct! (${q.correct.join(', ')}) ${btnA} ${btn2}`;
                } else {
                    feedback.innerHTML = `<i class="fas fa-times"></i> Correct Answers: <strong>${q.correct.join(', ')}</strong> ${btnA} ${btn2}`;
                }
            });

            // Passage 3: Yes/No/NG
            testData.passage3.yesNoNg.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 3, q.evidenceId);
            });

            // Passage 3: Summary (Options)
            testData.passage3.summary.forEach(q => {
                const inp = document.getElementById(`q${q.id}`);
                const val = inp.value.trim().toUpperCase();
                const feedback = inp.nextElementSibling;
                const isCorrect = val === q.correct;
                
                feedback.classList.remove('hidden');
                feedback.className = "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " + (isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                
                if(isCorrect) { score++; feedback.innerHTML = `<i class="fas fa-check"></i> Correct! ${feedbackBtn(3, q.evidenceId)}`; }
                else { feedback.innerHTML = `<i class="fas fa-times"></i> Ans: <strong>${q.correct}</strong> ${feedbackBtn(3, q.evidenceId)}`; }
            });

            // Passage 3: MCQ
            testData.passage3.mcq.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 3, q.evidenceId);
            });

            // Update Total Score Display
            document.getElementById('score-value').textContent = score;
            document.getElementById('score-display').classList.remove('hidden');
            document.getElementById('btn-check').classList.add('hidden');
            document.getElementById('btn-retry').classList.remove('hidden');
        }

        // --- SHOW EVIDENCE LOGIC ---
        function showEvidence(passageId, evidenceId) {
            switchTab(passageId);
            document.querySelectorAll('.evidence-active').forEach(el => el.classList.remove('evidence-active', 'evidence-pulse'));
            const el = document.getElementById(evidenceId);
            if (el) {
                setTimeout(() => {
                    el.classList.add('evidence-active', 'evidence-pulse');
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function resetTest() {
            document.querySelectorAll('input').forEach(i => {
                if(i.type === 'radio' || i.type === 'checkbox') i.checked = false;
                if(i.type === 'text') i.value = '';
            });
            document.querySelectorAll('.feedback').forEach(f => f.classList.add('hidden'));
            document.querySelectorAll('.feedback-inline').forEach(f => f.classList.add('hidden'));
            document.querySelectorAll('.evidence-active').forEach(e => e.classList.remove('evidence-active', 'evidence-pulse'));
            
            document.getElementById('score-display').classList.add('hidden');
            document.getElementById('btn-check').classList.remove('hidden');
            document.getElementById('btn-retry').classList.add('hidden');
            
            switchTab(1);
            document.getElementById('passage-container').scrollTop = 0;
            document.getElementById('questions-panel').scrollTop = 0;
        }

        // --- HIGHLIGHTER ---
        function setupHighlighter() {
            const container = document.getElementById('passage-container');
            container.addEventListener('scroll', () => document.getElementById('selection-toolbar').classList.add('hidden'));
            document.addEventListener('mousedown', (e) => {
                const toolbar = document.getElementById('selection-toolbar');
                if (!toolbar.contains(e.target) && !container.contains(e.target)) {
                    toolbar.classList.add('hidden');
                }
            });
        }

        function checkSelection() {
            const selection = window.getSelection();
            const toolbar = document.getElementById('selection-toolbar');
            const activePassage = document.querySelector('.passage-content.active');
            if (!selection.isCollapsed && activePassage && activePassage.contains(selection.anchorNode)) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                toolbar.style.top = `${rect.top - 45}px`;
                toolbar.style.left = `${rect.left + (rect.width / 2) - 60}px`;
                toolbar.classList.remove('hidden');
            } else {
                toolbar.classList.add('hidden');
            }
        }

        function performHighlight() {
            document.designMode = "on"; document.execCommand("hiliteColor", false, "#fef08a"); document.designMode = "off";
            window.getSelection().removeAllRanges();
            document.getElementById('selection-toolbar').classList.add('hidden');
        }

        function clearHighlight() {
            document.designMode = "on"; document.execCommand("removeFormat"); document.designMode = "off";
            window.getSelection().removeAllRanges();
            document.getElementById('selection-toolbar').classList.add('hidden');
        }

        init();
    </script>
</body>
</html>
