<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .highlight-correct { background-color: #dcfce7; border-color: #22c55e; color: #15803d; }
        .highlight-wrong { background-color: #fee2e2; border-color: #ef4444; color: #b91c1c; }

        /* Evidence Highlighting (System) */
        .evidence-text { transition: background-color 0.3s ease; border-radius: 2px; }
        .evidence-active { background-color: #fde047; box-shadow: 0 0 0 2px #fde047; color: #000; }
        
        /* User Highlighting */
        ::selection { background-color: #c7d2fe; color: #1e1b4b; } 

        @keyframes pulse-highlight {
            0% { background-color: #fde047; transform: scale(1); }
            50% { background-color: #facc15; transform: scale(1.02); }
            100% { background-color: #fde047; transform: scale(1); }
        }
        .evidence-pulse { animation: pulse-highlight 1s ease-in-out infinite; }

        /* Floating Toolbar */
        #selection-toolbar {
            z-index: 100;
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tabs */
        .tab-btn.active {
            border-bottom: 2px solid #2563eb;
            color: #2563eb;
            font-weight: 600;
        }
        .passage-content { display: none; }
        .passage-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center flex-shrink-0 z-10 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-700 rounded flex items-center justify-center text-white font-bold">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <h1 class="text-xl font-bold text-gray-800">IELTS Reading: Full Mock Test</h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                <i class="far fa-clock mr-1"></i> 60 mins
            </div>
            <button onclick="resetTest()" class="text-gray-500 hover:text-blue-600 transition-colors">
                <i class="fas fa-redo"></i> Reset
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden flex-col md:flex-row relative">
        
        <!-- Left Panel: Reading Passages (Tabbed) -->
        <section class="flex-1 bg-white border-r border-gray-200 flex flex-col md:w-1/2 overflow-hidden">
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-200 bg-gray-50">
                <button onclick="switchTab(1)" id="tab-1" class="tab-btn active flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 1</button>
                <button onclick="switchTab(2)" id="tab-2" class="tab-btn flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 2</button>
                <button onclick="switchTab(3)" id="tab-3" class="tab-btn flex-1 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors">Passage 3</button>
            </div>

            <!-- Content Container -->
            <div id="passage-container" class="flex-1 overflow-y-auto custom-scroll p-8 scroll-smooth relative" onmouseup="checkSelection()">
                
                <!-- Passage 1 -->
                <div id="passage-1" class="passage-content active max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">The Kākāpō</h2>
                    <p class="mb-4">The kākāpō is a nocturnal, flightless parrot that is critically endangered and one of New Zealand’s unique treasures.</p>
                    <p class="mb-4">The kākāpō, also known as the owl parrot, is a large, forest-dwelling bird, with a pale owl-like face. Up to 64 cm in length, it has predominantly yellow-green feathers, forward-facing eyes, a large grey beak, large blue feet, and relatively short wings and tail. <span id="ev-p1-q1" class="evidence-text">It is the world’s only flightless parrot</span>, and is also possibly one of the world’s longest-living birds, with a reported lifespan of up to 100 years.</p>
                    <p class="mb-4">Kākāpō are solitary birds and tend to occupy the same home range for many years. They forage on the ground and climb high into trees. They often leap from trees and flap their wings, but at best manage a controlled descent to the ground. They are entirely vegetarian, with <span id="ev-p1-q7" class="evidence-text">their diet including the leaves, roots and bark of trees as well as bulbs</span>, and fern fronds.</p>
                    <p class="mb-4">Kākāpō breed in summer and autumn, but <span id="ev-p1-q2" class="evidence-text">only in years when food is plentiful</span>. <span id="ev-p1-q3" class="evidence-text">Males play no part in incubation or chick-rearing – females alone incubate eggs and feed the chicks</span>. <span id="ev-p1-q8" class="evidence-text">The 1–4 eggs are laid in soil</span>, which is repeatedly turned over before and during incubation. The female kākāpō has to spend long periods away from the nest searching for food, which leaves the unattended eggs and chicks particularly vulnerable to predators.</p>
                    <p class="mb-4">Before humans arrived, kākāpō were common throughout New Zealand’s forests. However, this all changed with the arrival of the first Polynesian settlers about 700 years ago. For the early settlers, the flightless kākāpō was easy prey. They ate its meat and <span id="ev-p1-q9" class="evidence-text">used its feathers to make soft cloaks</span>. <span id="ev-p1-q4" class="evidence-text">With them came the Polynesian dog and rat, which also preyed on kākāpō.</span> By the time European colonisers arrived in the early 1800s, kākāpō had become confined to the central North Island and forested parts of the South Island. The fall in kākāpō numbers was accelerated by European colonisation. A great deal of habitat was lost through forest clearance, and <span id="ev-p1-q10" class="evidence-text">introduced species such as deer depleted the remaining forests of food</span>. Other predators such as cats, stoats and two more species of rat were also introduced. The kākāpō were in serious trouble.</p>
                    <p class="mb-4">In 1894, the New Zealand government launched its first attempt to save the kākāpō. Conservationist Richard Henry led an effort to relocate several hundred of the birds to predator-free Resolution Island in Fiordland. Unfortunately, the island didn’t remain predator free – stoats arrived within six years, eventually destroying the kākāpō population. By the mid-1900s, the kākāpō was practically a lost species. Only a few clung to life in the most isolated parts of New Zealand.</p>
                    <p class="mb-4">From 1949 to 1973, the newly formed New Zealand Wildlife Service made over 60 expeditions to find kākāpō, focusing mainly on Fiordland. Six were caught, but there were no females amongst them and all but one died within a few months of captivity.</p>
                    <p class="mb-4">In 1974, a new initiative was launched, and by 1977, 18 more kākāpō were found in Fiordland. However, there were still no females. In 1977, a large population of males was spotted in Rakiura – a large island free from stoats, ferrets and weasels. There were about 200 individuals, and <span id="ev-p1-q11" class="evidence-text">in 1980 it was confirmed females were also present</span>. These birds have been the foundation of all subsequent work in managing the species.</p>
                    <p class="mb-4">Unfortunately, <span id="ev-p1-q5" class="evidence-text">predation by feral cats on Rakiura Island led to a rapid decline in kākāpō numbers. As a result, during 1980–97, the surviving population was evacuated to three island sanctuaries</span>: Codfish Island, Maud Island and Little Barrier Island. However, breeding success was hard to achieve. Rats were found to be a major predator of kākāpō chicks, and an insufficient number of chicks survived to offset adult mortality. By 1995, although at least 12 chicks had been produced on the islands, only three had survived. The kākāpō population had dropped to 51 birds.</p>
                    <p class="mb-4">The critical situation prompted an urgent review of kākāpō management in New Zealand. In 1996, a new Recovery Plan was launched, together with a specialist advisory group called the Kākāpō Scientific and Technical Advisory Committee and <span id="ev-p1-q12" class="evidence-text">a higher amount of funding</span>. Renewed steps were taken to control predators on the three islands. Cats were eradicated from Little Barrier Island in 1980, and possums were eradicated from Codfish Island by 1986. However, the population did not start to increase until rats were removed from all three islands, and the birds were more intensively managed. This involved moving the birds between islands, supplementary feeding of adults, and <span id="ev-p1-q6" class="evidence-text">rescuing and hand-raising any failing chicks</span>. After the first five years of the Recovery Plan, the population was on target. By 2000, five new females had been produced, and the total population had grown to 62 birds. For the first time, there was cautious optimism for the future of kākāpō, and by June 2020, a total of 210 birds was recorded.</p>
                    <p class="mb-4">Today, kākāpō management continues to be guided by the kākāpō Recovery Plan. Its key goals are: minimise the loss of genetic diversity in the kākāpō population, restore or maintain sufficient habitat to accommodate the expected increase in the kākāpō population, and <span id="ev-p1-q13" class="evidence-text">ensure stakeholders continue to be fully engaged in the preservation of the species</span>.</p>
                </div>

                <!-- Passage 2 -->
                <div id="passage-2" class="passage-content max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">The Return of the Elm?</h2>
                    <p class="mb-4 italic text-gray-600">Mark Rowe investigates attempts to reintroduce elms to Britain</p>
                    
                    <p class="mb-4"><span class="font-bold text-blue-800">A</span> Around 25 million elms, accounting for 90% of all elm trees in the UK, died during the 1960s and ’70s of Dutch elm disease. In the aftermath, the elm, once so dominant in the British landscape, was largely forgotten. However, there’s now hope the elm may be reintroduced to the countryside of central and southern England. Any reintroduction will start from a very low base. ‘The impact of the disease is difficult to picture if you hadn’t seen what was there before,’ says Matt Elliot of the Woodland Trust. <span id="ev-p2-q23" class="evidence-text">‘You look at old photographs from the 1960s and it’s only then that you realise the impact [elms had] ... They were significant, large trees … then they were gone.’</span></p>

                    <p class="mb-4"><span class="font-bold text-blue-800">B</span> The disease is caused by a fungus that blocks the elms’ vascular (water, nutrient and food transport) system, causing branches to wilt and die. A first epidemic, which occurred in the 1920s, gradually died down, but in the ’70s <span id="ev-p2-q16" class="evidence-text">a second epidemic was triggered by shipments of elm from Canada. The wood came in the form of logs destined for boat building</span> and its intact bark was perfect for the elm bark beetles that spread the deadly fungus. This time, the beetles carried a much more virulent strain that destroyed the vast majority of British elms.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">C</span> Today, elms still exist in the southern English countryside but mostly only in low hedgerows between fields. ‘We have millions of small elms in hedgerows but they get targeted by the beetle as soon as they reach a certain size,’ says Karen Russell, co-author of the report <em>Where we are with elm</em>. <span id="ev-p2-q18" class="evidence-text">Once the trunk of the elm reaches 10–15 centimetres or so in diameter, it becomes a perfect size for beetles to lay eggs and for the fungus to take hold.</span> Yet mature specimens have been identified, in counties such as Cambridgeshire, that are hundreds of years old, and have mysteriously escaped the epidemic. The key, Russell says, is to identify and study those trees that have survived and work out why they stood tall when millions of others succumbed. <span id="ev-p2-q14" class="evidence-text">Nevertheless, opportunities are limited as the number of these mature survivors is relatively small.</span> ‘What are the reasons for their survival?’ asks Russell. <span id="ev-p2-q21" class="evidence-text">‘Avoidance, tolerance, resistance? We don’t know where the balance lies between the three. I don’t see how it can be entirely down to luck.’</span></p>

                    <p class="mb-4"><span class="font-bold text-blue-800">D</span> <span id="ev-p2-q24" class="evidence-text">For centuries, elm ran a close second to oak as the hardwood tree of choice in Britain</span> and was in many instances the most prominent tree in the landscape. Not only was elm common in European forests, it became a key component of birch, ash and hazel woodlands. The use of elm is thought to go back to the Bronze Age, when it was widely used for tools. Elm was also the preferred material for shields and early swords. In the 18th century, it was planted more widely and <span id="ev-p2-q25" class="evidence-text">its wood was used for items such as storage crates and flooring.</span> It was also suitable for items that experienced high levels of impact and was <span id="ev-p2-q26" class="evidence-text">used to build the keel of the 19th-century sailing ship Cutty Sark</span> as well as mining equipment.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">E</span> Given how ingrained elm is in British culture, it’s unsurprising the tree has many advocates. Amongst them is Peter Bourne of the National Elm Collection in Brighton. ‘I saw Dutch elm disease unfold as a small boy,’ he says. ‘The elm seemed to be part of rural England, but I remember watching trees just lose their leaves and that really stayed with me.’ Today, the city of Brighton’s elms total about 17,000. Local factors appear to have contributed to their survival. <span id="ev-p2-q17" class="evidence-text">Strong winds from the sea make it difficult for the determined elm bark beetle to attack this coastal city’s elm population.</span> However, the situation is precarious. <span id="ev-p2-q22" class="evidence-text">‘The beetles can just march in if we’re not careful, as the threat is right on our doorstep,’</span> says Bourne.</p>

                    <p class="mb-4"><span class="font-bold text-blue-800">F</span> Any prospect of the elm returning relies heavily on trees being either resistant to, or tolerant of, the disease. This means a widespread reintroduction would involve existing or new hybrid strains derived from resistant, generally non-native elm species. A new generation of seedlings have been bred and tested to see if they can withstand the fungus by cutting a small slit on the bark and injecting a tiny amount of the pathogen. <span id="ev-p2-q19" class="evidence-text">‘The effects are very quick,’ says Russell. ‘You return in four to six weeks and trees that are resistant show no symptoms, whereas those that are susceptible show leaf loss and may even have died completely.’</span></p>

                    <p class="mb-4"><span class="font-bold text-blue-800">G</span> All of this raises questions of social acceptance, acknowledges Russell. ‘If we’re putting elm back into the landscape, a small element of it is not native—are we bothered about that?’ <span id="ev-p2-q15" class="evidence-text">For her, the environmental case for reintroducing elm is strong. ‘They will host wildlife, which is a good thing.’ Others are more wary. ‘On the face of it, it seems like a good idea,’ says Elliot. The problem, he suggests, is that, ‘You’re replacing a native species with a horticultural analogue. You’re effectively cloning.’</span> There’s also the risk of introducing new diseases. Rather than plant new elms, the Woodland Trust emphasises providing space to those elms that have survived independently. <span id="ev-p2-q20" class="evidence-text">‘Sometimes the best thing you can do is just give nature time to recover ... over time, you might get resistance,’ says Elliot.</span></p>
                    
                    <p class="text-sm italic text-gray-500 border-t pt-2 mt-4">*horticultural analogue: a cultivated plant species that is genetically similar to an existing species.</p>
                </div>

                <!-- Passage 3 -->
                <div id="passage-3" class="passage-content max-w-3xl mx-auto text-gray-800 leading-relaxed text-lg">
                    <h2 class="text-2xl font-bold mb-6 text-gray-900 border-b pb-2">How stress affects our judgement</h2>
                    <p class="mb-4">Some of the most important decisions of our lives occur while we're feeling stressed and anxious. From medical decisions to financial and professional ones, <span id="ev-p3-q27" class="evidence-text">we are all sometimes required to weigh up information under stressful conditions.</span> But do we become better or worse at processing and using information under such circumstances?</p>

                    <p class="mb-4">My colleague and I, both neuroscientists, wanted to investigate how the mind operates under stress, so we visited some local fire stations. Firefighters' workdays vary quite a bit. Some are pretty relaxed; they'll spend their time washing the truck, cleaning equipment, cooking meals and reading. Other days can be hectic, with numerous life-threatening incidents to attend to; they'll enter burning homes to rescue trapped residents, and assist with medical emergencies. <span id="ev-p3-q28" class="evidence-text">These ups and downs presented the perfect setting for an experiment</span> on how people's ability to use information changes when they feel under pressure.</p>

                    <p class="mb-4">We found that perceived threat acted as a trigger for a stress reaction that made the task of processing information easier for the firefighters – but only as long as it conveyed bad news.</p>

                    <p class="mb-4"><span id="ev-p3-q29" class="evidence-text">This is how we arrived at these results.</span> We asked the firefighters to estimate their likelihood of experiencing 40 different adverse events in their life, such as being involved in an accident or becoming a victim of card fraud. We then gave them either good news (that their likelihood of experiencing these events was lower than they'd thought) or bad news (that it was higher) and asked them to provide new estimates.</p>

                    <p class="mb-4">People are normally quite optimistic – <span id="ev-p3-q31" class="evidence-text">they will ignore bad news and embrace the good.</span> This is what happened when the firefighters were relaxed; but when they were under stress, a different pattern emerged. Under these conditions, <span id="ev-p3-q32" class="evidence-text">they became hyper-vigilant to bad news, even when it had nothing to do with their job (such as learning that the likelihood of card fraud was higher than they'd thought), and altered their beliefs in response.</span> In contrast, <span id="ev-p3-q33" class="evidence-text">stress didn't change how they responded to good news</span> (such as learning that the likelihood of card fraud was lower than they'd thought).</p>

                    <p class="mb-4">Back in our lab, we observed the same pattern in students who were <span id="ev-p3-q34" class="evidence-text">told they had to give a surprise public speech, which would be judged by a panel, recorded and posted online. Sure enough, their cortisol levels spiked,</span> their heart rates went up and they <span id="ev-p3-q35" class="evidence-text">suddenly became better at processing unrelated, yet alarming, information</span> about rates of disease and violence.</p>

                    <p class="mb-4">When we experience stressful events, a physiological change is triggered that causes us to take in warnings and focus on what might go wrong. Brain imaging reveals that this 'switch' is related to <span id="ev-p3-q30" class="evidence-text">a sudden boost in a neural signal important for learning, specifically in response to unexpected warning signs,</span> such as faces expressing fear.</p>

                    <p class="mb-4">Such neural engineering could have helped prehistoric humans to survive. When our ancestors found themselves surrounded by hungry animals, they would have benefited from an increased ability to learn about hazards. In a safe environment, however, it would have been wasteful to be on high alert constantly. So, a neural switch that automatically increases or decreases our ability to process warnings in response to changes in our environment could have been useful. In fact, people with clinical depression and anxiety seem unable to switch away from a state in which they absorb all the negative messages around them.</p>

                    <p class="mb-4">It is also important to realise that stress travels rapidly from one person to the next. If a co-worker is stressed, we are more likely to tense up and feel stressed ourselves. We don't even need to be in the same room with someone for their emotions to influence our behaviour. Studies show that <span id="ev-p3-q36" class="evidence-text">if we observe positive feeds on social media, such as images of a pink sunset, we are more likely to post uplifting messages ourselves. If we observe negative posts, such as complaints about a long queue at the coffee shop, we will in turn create more negative posts.</span></p>

                    <p class="mb-4">In some ways, many of us now live as if we are in danger, constantly ready to tackle demanding emails and text messages, and respond to news alerts and comments on social media. Repeatedly checking your phone, according to a survey conducted by the American Psychological Association, is related to stress. In other words, a pre-programmed physiological reaction, which evolution has equipped us with to help us avoid famished predators, is now being triggered by an online post. Social media posting, according to one study, raises your pulse, makes you sweat, and enlarges your pupils more than most daily activities.</p>

                    <p class="mb-4">The fact that stress increases the likelihood that we will focus more on alarming messages, together with the fact that it spreads extremely rapidly, can create collective fear that is not always justified. After a stressful public event, such as a natural disaster or major financial crash, there is often a wave of alarming information in traditional and social media, which individuals become very aware of. But that has the effect of exaggerating existing danger. <span id="ev-p3-q38" class="evidence-text">And so, a reliable pattern emerges – stress is triggered, spreading from one person to the next, which temporarily enhances the likelihood that people will take in negative reports, which increases stress further.</span> <span id="ev-p3-q39" class="evidence-text">As a result, trips are cancelled, even if the disaster took place across the globe; stocks are sold, even when holding on is the best thing to do.</span></p>

                    <p class="mb-4">The good news, however, is that positive emotions, such as hope, are contagious too, and <span id="ev-p3-q40" class="evidence-text">are powerful in inducing people to act to find solutions. Being aware of the close relationship between people's emotional state and how they process information can help us frame our messages more effectively and become conscientious agents of change.</span></p>
                </div>
            </div>

            <!-- Highlighter Toolbar -->
            <div id="selection-toolbar" class="hidden fixed bg-gray-900 text-white rounded shadow-xl py-1 px-2 flex gap-1 z-50 text-sm">
                <button onclick="performHighlight()" class="hover:bg-gray-700 px-3 py-1 rounded transition-colors flex items-center gap-2">
                    <div class="w-3 h-3 bg-yellow-200 rounded-full border border-yellow-400"></div> Highlight
                </button>
                <div class="w-px bg-gray-700 my-1"></div>
                <button onclick="clearHighlight()" class="hover:bg-gray-700 px-3 py-1 rounded transition-colors text-gray-300">
                    <i class="fas fa-eraser"></i>
                </button>
            </div>
        </section>

        <!-- Right Panel: Questions -->
        <section class="flex-1 bg-gray-50 overflow-y-auto custom-scroll p-8 md:w-1/2 relative" id="questions-panel">
            <div class="max-w-2xl mx-auto pb-24">
                <div id="questions-container" class="space-y-12">
                    <!-- Questions injected via JS -->
                </div>
            </div>

            <!-- Floating Action Bar -->
            <div class="fixed bottom-0 right-0 w-full md:w-1/2 bg-white border-t border-gray-200 p-4 shadow-lg flex justify-between items-center z-20">
                <div id="score-display" class="hidden font-bold text-gray-800 text-lg">
                    Score: <span id="score-value" class="text-blue-600">0</span>/40
                </div>
                <div class="ml-auto flex gap-3">
                    <button onclick="checkAnswers()" id="btn-check" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold shadow-sm transition-all transform hover:scale-105 active:scale-95">
                        Check Answers
                    </button>
                    <button onclick="resetTest()" id="btn-retry" class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-semibold transition-colors">
                        Retry
                    </button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- DATA ---
        const testData = {
            passage1: {
                tfng: [
                    { id: 1, text: "There are other parrots that share the kakapo’s inability to fly.", correct: "FALSE", evidenceId: "ev-p1-q1" },
                    { id: 2, text: "Adult kakapo produce chicks every year.", correct: "FALSE", evidenceId: "ev-p1-q2" },
                    { id: 3, text: "Adult male kakapo bring food back to nesting females.", correct: "FALSE", evidenceId: "ev-p1-q3" },
                    { id: 4, text: "The Polynesian rat was a greater threat to the kakapo than Polynesian settlers.", correct: "NOT GIVEN", evidenceId: "ev-p1-q4" },
                    { id: 5, text: "Kakapo were transferred from Rakiura Island to other locations because they were at risk from feral cats.", correct: "TRUE", evidenceId: "ev-p1-q5" },
                    { id: 6, text: "One Recovery Plan initiative that helped increase the kakapo population size was caring for struggling young birds.", correct: "TRUE", evidenceId: "ev-p1-q6" }
                ],
                gapFill: [
                    { id: 7, correct: ["bulbs"], evidenceId: "ev-p1-q7" },
                    { id: 8, correct: ["soil"], evidenceId: "ev-p1-q8" },
                    { id: 9, correct: ["feathers"], evidenceId: "ev-p1-q9" },
                    { id: 10, correct: ["deer"], evidenceId: "ev-p1-q10" },
                    { id: 11, correct: ["1980"], evidenceId: "ev-p1-q11" },
                    { id: 12, correct: ["funding"], evidenceId: "ev-p1-q12" },
                    { id: 13, correct: ["stakeholders"], evidenceId: "ev-p1-q13" }
                ]
            },
            passage2: {
                matchingInfo: [
                    { id: 14, text: "Reference to the research problems that arise from there being only a few surviving large elms", correct: "C", evidenceId: "ev-p2-q14" },
                    { id: 15, text: "Details of a difference of opinion about the value of reintroducing elms to Britain", correct: "G", evidenceId: "ev-p2-q15" },
                    { id: 16, text: "Reference to how Dutch elm disease was brought into Britain", correct: "B", evidenceId: "ev-p2-q16" },
                    { id: 17, text: "A description of the conditions that have enabled a location in Britain to escape Dutch elm disease", correct: "E", evidenceId: "ev-p2-q17" },
                    { id: 18, text: "Reference to the stage at which young elms become vulnerable to Dutch elm disease", correct: "C", evidenceId: "ev-p2-q18" }
                ],
                matchingPeople: [
                    { id: 19, text: "If a tree gets infected with Dutch elm disease, the damage rapidly becomes visible.", correct: "B", evidenceId: "ev-p2-q19" },
                    { id: 20, text: "It may be better to wait and see if the mature elms that have survived continue to flourish.", correct: "A", evidenceId: "ev-p2-q20" },
                    { id: 21, text: "There must be an explanation for the survival of some mature elms.", correct: "B", evidenceId: "ev-p2-q21" },
                    { id: 22, text: "We need to be aware that insects carrying Dutch elm disease are not very far away.", correct: "C", evidenceId: "ev-p2-q22" },
                    { id: 23, text: "You understand the effect Dutch elm disease has had when you see evidence of how prominent the tree once was.", correct: "A", evidenceId: "ev-p2-q23" }
                ],
                summary: [
                    { id: 24, correct: ["oak"], evidenceId: "ev-p2-q24" },
                    { id: 25, correct: ["flooring"], evidenceId: "ev-p2-q25" },
                    { id: 26, correct: ["keel"], evidenceId: "ev-p2-q26" }
                ]
            },
            passage3: {
                mcq: [
                    { id: 27, text: "In the first paragraph, the writer introduces the topic of the text by...", options: ["A. defining some commonly used terms.", "B. questioning a widely held assumption.", "C. mentioning a challenge faced by everyone.", "D. specifying a situation which makes us most anxious."], correct: "C", evidenceId: "ev-p3-q27" },
                    { id: 28, text: "What point does the writer make about firefighters in the second paragraph?", options: ["A. The regular changes of stress levels in their working lives make them ideal study subjects.", "B. The strategies they use to handle stress are of particular interest to researchers.", "C. The stressful nature of their job is typical of many public service professions.", "D. Their personalities make them especially well-suited to working under stress."], correct: "A", evidenceId: "ev-p3-q28" },
                    { id: 29, text: "What is the writer doing in the fourth paragraph?", options: ["A. explaining their findings", "B. justifying their approach", "C. setting out their objectives", "D. describing their methodology"], correct: "D", evidenceId: "ev-p3-q29" },
                    { id: 30, text: "In the seventh paragraph, the writer describes a mechanism in the brain which...", options: ["A. enables people to respond more quickly to stressful situations.", "B. results in increased ability to control our levels of anxiety.", "C. produces heightened sensitivity to indications of external threats.", "D. is activated when there is a need to communicate a sense of danger."], correct: "C", evidenceId: "ev-p3-q30" }
                ],
                matchingSentence: [
                    { id: 31, text: "At times when they were relaxed, the firefighters usually", correct: "B", evidenceId: "ev-p3-q31" },
                    { id: 32, text: "The researchers noted that when the firefighters were stressed, they", correct: "G", evidenceId: "ev-p3-q32" },
                    { id: 33, text: "When the firefighters were told good news, they always", correct: "F", evidenceId: "ev-p3-q33" },
                    { id: 34, text: "The students' cortisol levels and heart rates were affected when the researchers", correct: "E", evidenceId: "ev-p3-q34" },
                    { id: 35, text: "In both experiments, negative information was processed better when the subjects", correct: "D", evidenceId: "ev-p3-q35" }
                ],
                yesNoNg: [
                    { id: 36, text: "The tone of the content we post on social media tends to reflect the nature of the posts in our feeds.", correct: "YES", evidenceId: "ev-p3-q36" },
                    { id: 37, text: "Phones have a greater impact on our stress levels than other electronic media devices.", correct: "NOT GIVEN", evidenceId: "ev-p3-q37" },
                    { id: 38, text: "The more we read about a stressful public event on social media, the less able we are to take the information in.", correct: "NO", evidenceId: "ev-p3-q38" },
                    { id: 39, text: "Stress created by social media posts can lead us to take unnecessary precautions.", correct: "YES", evidenceId: "ev-p3-q39" },
                    { id: 40, text: "Our tendency to be affected by other people's moods can be used in a positive way.", correct: "YES", evidenceId: "ev-p3-q40" }
                ]
            }
        };

        // --- INIT ---
        function init() {
            renderQuestions();
            setupHighlighter();
        }

        // --- TABS ---
        function switchTab(id) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.passage-content').forEach(content => content.classList.remove('active'));
            
            document.getElementById(`tab-${id}`).classList.add('active');
            document.getElementById(`passage-${id}`).classList.add('active');
        }

        // --- RENDERERS ---
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            let html = '';

            // --- Passage 1 Questions ---
            html += `<div class="border-b-2 border-gray-200 pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 1: The Kākāpō</h3>`;
            
            // Q1-6 (TFNG)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 1-6</h4><p class="text-sm italic mb-4">True / False / Not Given</p><div class="space-y-4">`;
            testData.passage1.tfng.forEach(q => {
                html += createRadioBlock(q, ['TRUE', 'FALSE', 'NOT GIVEN']);
            });
            html += `</div></div>`;

            // Q7-13 (Gap Fill) with Headers - STRUCTURED
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6">
                <h4 class="font-bold mb-2">Questions 7-13</h4>
                <p class="text-sm italic mb-4">Complete the notes (ONE WORD ONLY)</p>
                <div class="space-y-4 bg-blue-50 p-6 rounded border border-blue-100 text-sm leading-7">
                    <h5 class="font-bold text-center text-blue-900 text-lg mb-4">New Zealand's kākāpō</h5>
                    
                    <div>A type of parrot:</div>
                    
                    <div class="question-block" data-id="7">
                        Diet consists of fern fronds, various parts of a tree and ${createInlineInput(7)}.
                    </div>
                    
                    <div class="question-block" data-id="8">
                        Nests are created in ${createInlineInput(8)} where eggs are laid.
                    </div>

                    <div class="font-bold mt-4 text-blue-900">Arrival of Polynesian settlers</div>
                    
                    <div class="question-block" data-id="9">
                        The ${createInlineInput(9)} of the kākāpō were used to make clothes.
                    </div>

                    <div class="font-bold mt-4 text-blue-900">Arrival of European colonisers</div>
                    
                    <div class="question-block" data-id="10">
                        ${createInlineInput(10)} were an animal which they introduced that ate the kākāpō's food sources.
                    </div>

                    <div class="font-bold mt-4 text-blue-900">Protecting kākāpō</div>
                    <div>Richard Henry, a conservationist, tried to protect the kākāpō.</div>
                    
                    <div class="question-block" data-id="11">
                        A definite sighting of female kākāpō on Rakiura Island was reported in the year ${createInlineInput(11)}.
                    </div>
                    
                    <div class="question-block" data-id="12">
                        The Recovery Plan included an increase in ${createInlineInput(12)}.
                    </div>
                    
                    <div class="question-block" data-id="13">
                        A current goal of the Recovery Plan is to maintain the involvement of ${createInlineInput(13)} in kākāpō protection.
                    </div>
                </div>
            </div></div>`;

            // --- Passage 2 Questions ---
            html += `<div class="border-b-2 border-gray-200 pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 2: The Return of the Elm?</h3>`;
            
            // Q14-18 (Matching Info)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 14-18</h4><p class="text-sm italic mb-4">Which paragraph (A-G) contains the following information?</p><div class="space-y-4">`;
            testData.passage2.matchingInfo.forEach(q => {
                html += createRadioBlock(q, ['A','B','C','D','E','F','G']);
            });
            html += `</div></div>`;

            // Q19-23 (Matching People)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 19-23</h4><p class="text-sm italic mb-4">Match statement with person (A=Elliot, B=Russell, C=Bourne)</p><div class="space-y-4">`;
            testData.passage2.matchingPeople.forEach(q => {
                html += createRadioBlock(q, ['A','B','C']);
            });
            html += `</div></div>`;

            // Q24-26 (Summary) - FULL TEXT RESTORED
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 24-26</h4><p class="text-sm italic mb-4">Complete the summary (ONE WORD ONLY)</p>
            <div class="p-4 bg-gray-50 rounded border leading-8 text-sm">
                <h5 class="font-bold text-center text-gray-800 mb-2">Uses of a Popular Tree</h5>
                For hundreds of years, the only tree that was more popular in Britain than elm was ${createInlineInput(24)}. Starting in the Bronze Age, many tools were made from elm, and people also used it to make weapons. In the 18th century, it was grown to provide wood for boxes and ${createInlineInput(25)}. Due to its strength, elm was often used for mining equipment and the Cutty Sark’s ${createInlineInput(26)} was also constructed from elm.
            </div></div></div>`;

            // --- Passage 3 Questions ---
            html += `<div class="pb-8"><h3 class="text-xl font-bold mb-4 text-blue-800">Passage 3: Stress and Judgement</h3>`;
            
            // Q27-30 (MCQ)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 27-30</h4><p class="text-sm italic mb-4">Choose the correct letter A, B, C or D</p><div class="space-y-6">`;
            testData.passage3.mcq.forEach(q => {
                html += `<div class="question-block" data-id="${q.id}">
                    <div class="flex gap-2 font-bold text-gray-700"><span>${q.id}.</span> <p>${q.text}</p></div>
                    <div class="mt-2 space-y-2 ml-6">
                        ${q.options.map(opt => {
                            const val = opt.charAt(0);
                            return `<label class="block cursor-pointer hover:bg-gray-50 p-2 rounded"><input type="radio" name="q${q.id}" value="${val}" class="mr-2"> ${opt}</label>`;
                        }).join('')}
                    </div>
                    <div class="feedback mt-2 ml-6 hidden text-sm"></div>
                </div>`;
            });
            html += `</div></div>`;

            // Q31-35 (Matching Sentence Endings)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 31-35</h4><p class="text-sm italic mb-4">Match the sentence ending (A-G)</p>
                <div class="mb-4 text-sm bg-gray-50 p-3 rounded border">
                    A. made them feel optimistic <br> B. took relatively little notice of bad news <br> C. responded to negative and positive information in the same way <br> D. were feeling under stress <br> E. put them in a stressful situation <br> F. behaved in a similar manner <br> G. thought it more likely that they would experience something bad
                </div>
                <div class="space-y-4">`;
            testData.passage3.matchingSentence.forEach(q => {
                html += `<div class="question-block" data-id="${q.id}">
                    <div class="flex items-center justify-between">
                        <span class="w-8 font-bold">${q.id}.</span>
                        <p class="flex-1 text-sm">${q.text}...</p>
                        <input type="text" id="q${q.id}" class="w-12 border rounded p-1 text-center font-bold uppercase" maxlength="1">
                    </div>
                    <div class="feedback mt-1 ml-8 hidden text-sm"></div>
                </div>`;
            });
            html += `</div></div>`;

            // Q36-40 (Yes/No/NG)
            html += `<div class="bg-white p-6 rounded shadow-sm mb-6"><h4 class="font-bold mb-2">Questions 36-40</h4><p class="text-sm italic mb-4">Yes / No / Not Given</p><div class="space-y-4">`;
            testData.passage3.yesNoNg.forEach(q => {
                html += createRadioBlock(q, ['YES', 'NO', 'NOT GIVEN']);
            });
            html += `</div></div></div>`;

            container.innerHTML = html;
        }

        // --- HELPER BUILDERS ---
        function createRadioBlock(q, options) {
            return `
            <div class="question-block border-b border-gray-100 pb-3 last:border-0" data-id="${q.id}">
                <div class="flex gap-4">
                    <span class="font-bold text-gray-500 w-6 pt-1">${q.id}</span>
                    <div class="flex-1">
                        <p class="mb-2 text-gray-800 text-sm">${q.text}</p>
                        <div class="flex flex-wrap gap-2">
                            ${options.map(opt => `
                                <label class="cursor-pointer">
                                    <input type="radio" name="q${q.id}" value="${opt}" class="peer sr-only">
                                    <div class="px-3 py-1 rounded border border-gray-300 text-xs font-bold text-gray-600 bg-white 
                                                peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 
                                                hover:bg-gray-50 transition-all select-none">
                                        ${opt}
                                    </div>
                                </label>
                            `).join('')}
                        </div>
                        <div class="feedback mt-2 hidden text-sm"></div>
                    </div>
                </div>
            </div>`;
        }

        function createInlineInput(id) {
            return `<span class="inline-block relative mx-1 align-baseline">
                <span class="font-bold text-gray-400 absolute -left-4 -top-2 text-xs">${id}</span>
                <input type="text" id="q${id}" class="w-28 border-b-2 border-gray-400 bg-transparent px-1 text-center focus:outline-none focus:border-blue-600 font-bold text-blue-900 text-sm h-6">
                <div class="feedback-inline absolute hidden bg-white shadow-lg p-2 rounded z-10 text-xs w-40 border top-full left-0 mt-1"></div>
            </span>`;
        }

        // --- CHECKING LOGIC ---
        function checkAnswers() {
            let score = 0;
            const feedbackBtn = (pid, eid) => `<button onclick="showEvidence(${pid}, '${eid}')" class="ml-2 text-blue-600 hover:bg-blue-50 px-2 rounded" title="Show Evidence"><i class="fas fa-eye"></i></button>`;

            const processResult = (element, isCorrect, correctAns, pid, eid) => {
                // Determine if element is a question-block or an input
                let feedbackEl = element.querySelector('.feedback');
                if (!feedbackEl) {
                    // Try next sibling (for inline inputs inside summaries/notes)
                    if(element.nextElementSibling && element.nextElementSibling.classList.contains('feedback-inline')) {
                        feedbackEl = element.nextElementSibling;
                    }
                }
                
                if (!feedbackEl) return;
                
                feedbackEl.classList.remove('hidden');
                feedbackEl.className = feedbackEl.classList.contains('feedback-inline') 
                    ? "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " 
                    : "feedback mt-2 text-sm p-2 rounded block ";
                
                feedbackEl.classList.add(isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                if(feedbackEl.classList.contains('feedback-inline')) feedbackEl.style.border = isCorrect ? "1px solid #bbf7d0" : "1px solid #fecaca";

                if (isCorrect) {
                    score++;
                    feedbackEl.innerHTML = `<i class="fas fa-check mr-1"></i> Correct! ${eid ? feedbackBtn(pid, eid) : ''}`;
                } else {
                    feedbackEl.innerHTML = `<i class="fas fa-times mr-1"></i> Correct: <strong>${correctAns}</strong> ${eid ? feedbackBtn(pid, eid) : ''}`;
                }
            };

            // Passage 1
            testData.passage1.tfng.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 1, q.evidenceId);
            });
            // Passage 1 Gap Fill (Custom Logic due to HTML structure)
            testData.passage1.gapFill.forEach(q => {
                const block = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const inp = document.getElementById(`q${q.id}`);
                const val = inp.value.trim().toLowerCase();
                // Create a dynamic feedback element if it doesn't exist for these blocks (since they are now inline inputs)
                let feedback = inp.nextElementSibling;
                if(!feedback || !feedback.classList.contains('feedback-inline')) {
                     // The helper createInlineInput creates the feedback div, so it should be there.
                     feedback = inp.nextElementSibling;
                }
                const isCorrect = q.correct.includes(val);
                
                feedback.classList.remove('hidden');
                feedback.className = "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " + (isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");
                
                if (isCorrect) {
                    score++;
                    feedback.innerHTML = `<i class="fas fa-check mr-1"></i> Correct! ${feedbackBtn(1, q.evidenceId)}`;
                } else {
                    feedback.innerHTML = `<i class="fas fa-times mr-1"></i> Ans: <strong>${q.correct[0]}</strong> ${feedbackBtn(1, q.evidenceId)}`;
                }
            });


            // Passage 2
            testData.passage2.matchingInfo.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 2, q.evidenceId);
            });
            testData.passage2.matchingPeople.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 2, q.evidenceId);
            });
            testData.passage2.summary.forEach(q => {
                const inp = document.getElementById(`q${q.id}`);
                const feedback = inp.nextElementSibling;
                const val = inp.value.trim().toLowerCase();
                const isCorrect = q.correct.includes(val);
                
                feedback.classList.remove('hidden');
                feedback.className = "feedback-inline absolute bg-white shadow-lg p-2 rounded z-10 text-xs w-48 border top-full left-0 mt-1 " + (isCorrect ? "bg-green-50 text-green-800 border-green-200" : "bg-red-50 text-red-800 border-red-200");

                if (isCorrect) {
                    score++;
                    feedback.innerHTML = `<i class="fas fa-check text-green-600"></i> Correct! ${feedbackBtn(2, q.evidenceId)}`;
                } else {
                    feedback.innerHTML = `<i class="fas fa-times text-red-600"></i> Ans: <strong>${q.correct[0]}</strong> ${feedbackBtn(2, q.evidenceId)}`;
                }
            });

            // Passage 3
            testData.passage3.mcq.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 3, q.evidenceId);
            });
            testData.passage3.matchingSentence.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const inp = document.getElementById(`q${q.id}`);
                const val = inp.value.trim().toUpperCase();
                processResult(el, val === q.correct, q.correct, 3, q.evidenceId);
            });
            testData.passage3.yesNoNg.forEach(q => {
                const el = document.querySelector(`.question-block[data-id="${q.id}"]`);
                const sel = document.querySelector(`input[name="q${q.id}"]:checked`);
                processResult(el, sel && sel.value === q.correct, q.correct, 3, q.evidenceId);
            });

            document.getElementById('score-value').textContent = score;
            document.getElementById('score-display').classList.remove('hidden');
            document.getElementById('btn-check').classList.add('hidden');
            document.getElementById('btn-retry').classList.remove('hidden');
        }

        // --- SHOW EVIDENCE LOGIC ---
        function showEvidence(passageId, evidenceId) {
            // 1. Switch Tab
            switchTab(passageId);

            // 2. Remove old highlights
            document.querySelectorAll('.evidence-active').forEach(el => el.classList.remove('evidence-active', 'evidence-pulse'));

            // 3. Highlight new
            const el = document.getElementById(evidenceId);
            if (el) {
                // Short delay to allow tab switch rendering
                setTimeout(() => {
                    el.classList.add('evidence-active', 'evidence-pulse');
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function resetTest() {
            document.querySelectorAll('input').forEach(i => {
                if(i.type === 'radio') i.checked = false;
                if(i.type === 'text') i.value = '';
            });
            document.querySelectorAll('.feedback').forEach(f => f.classList.add('hidden'));
            document.querySelectorAll('.feedback-inline').forEach(f => f.classList.add('hidden'));
            document.querySelectorAll('.evidence-active').forEach(e => e.classList.remove('evidence-active', 'evidence-pulse'));
            
            document.getElementById('score-display').classList.add('hidden');
            document.getElementById('btn-check').classList.remove('hidden');
            document.getElementById('btn-retry').classList.add('hidden');
            
            switchTab(1);
            document.getElementById('passage-container').scrollTop = 0;
            document.getElementById('questions-panel').scrollTop = 0;
        }

        // --- HIGHLIGHTER ---
        function setupHighlighter() {
            const container = document.getElementById('passage-container');
            container.addEventListener('scroll', () => document.getElementById('selection-toolbar').classList.add('hidden'));
            document.addEventListener('mousedown', (e) => {
                const toolbar = document.getElementById('selection-toolbar');
                if (!toolbar.contains(e.target) && !container.contains(e.target)) {
                    toolbar.classList.add('hidden');
                }
            });
        }

        function checkSelection() {
            const selection = window.getSelection();
            const toolbar = document.getElementById('selection-toolbar');
            const container = document.getElementById('passage-container');

            // Find which passage is active
            const activePassage = document.querySelector('.passage-content.active');

            if (!selection.isCollapsed && activePassage && activePassage.contains(selection.anchorNode)) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                toolbar.style.top = `${rect.top - 45}px`;
                toolbar.style.left = `${rect.left + (rect.width / 2) - 60}px`;
                toolbar.classList.remove('hidden');
            } else {
                toolbar.classList.add('hidden');
            }
        }

        function performHighlight() {
            const activePassage = document.querySelector('.passage-content.active');
            if (!activePassage) return;

            document.designMode = "on"; // Use designMode for broader support on divs
            document.execCommand("hiliteColor", false, "#fef08a");
            document.designMode = "off";
            window.getSelection().removeAllRanges();
            document.getElementById('selection-toolbar').classList.add('hidden');
        }

        function clearHighlight() {
            document.designMode = "on";
            document.execCommand("removeFormat");
            document.designMode = "off";
            window.getSelection().removeAllRanges();
            document.getElementById('selection-toolbar').classList.add('hidden');
        }

        init();
    </script>
</body>
</html>
